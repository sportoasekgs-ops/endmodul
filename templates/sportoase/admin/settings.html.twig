{% extends '@SportOase/base.html.twig' %}

{% block title %}Systemeinstellungen - SportOase{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                ‚öôÔ∏è Systemeinstellungen
            </h1>
            <p class="text-gray-600">
                Konfigurieren Sie Stundenzeiten, feste Angebote und Systemparameter
            </p>
        </div>

        <!-- Flash Messages -->
        {% for message in app.flashes('success') %}
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4 rounded">
                <p class="font-medium">‚úÖ {{ message }}</p>
            </div>
        {% endfor %}

        <!-- Tabs Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b border-gray-200">
                <button onclick="switchTab('periods')" id="tab-periods" class="tab-button active flex-1 py-4 px-6 text-center font-medium hover:bg-gray-50 transition">
                    üïê Stundenzeiten
                </button>
                <button onclick="switchTab('fixed-offers')" id="tab-fixed-offers" class="tab-button flex-1 py-4 px-6 text-center font-medium hover:bg-gray-50 transition">
                    üìã Feste Angebote
                </button>
                <button onclick="switchTab('modules')" id="tab-modules" class="tab-button flex-1 py-4 px-6 text-center font-medium hover:bg-gray-50 transition">
                    üéØ Module
                </button>
                <button onclick="switchTab('system')" id="tab-system" class="tab-button flex-1 py-4 px-6 text-center font-medium hover:bg-gray-50 transition">
                    üîß System
                </button>
            </div>
        </div>

        <!-- Tab: Stundenzeiten -->
        <div id="content-periods" class="tab-content bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Stundenzeiten bearbeiten</h2>
            <p class="text-gray-600 mb-6">Legen Sie die Start- und Endzeiten f√ºr jede Schulstunde fest.</p>
            
            <form method="POST" action="{{ path('sportoase_admin_settings') }}">
                <input type="hidden" name="action" value="update_periods">
                <input type="hidden" name="_token" value="{{ csrf_token('settings-periods') }}">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for period_num in 1..6 %}
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-bold text-lg text-gray-700 mb-3">{{ period_num }}. Stunde</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Start</label>
                                    <input type="time" 
                                           name="period_{{ period_num }}_start" 
                                           value="{{ periods[period_num].start }}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ende</label>
                                    <input type="time" 
                                           name="period_{{ period_num }}_end" 
                                           value="{{ periods[period_num].end }}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           required>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        üíæ Stundenzeiten speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab: Feste Angebote -->
        <div id="content-fixed-offers" class="tab-content hidden bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Feste Angebote pro Wochentag</h2>
            <p class="text-gray-600 mb-6">Definieren Sie feste Angebote f√ºr bestimmte Stunden. Lassen Sie das Feld leer, wenn die Stunde frei w√§hlbar sein soll.</p>
            
            <form method="POST" action="{{ path('sportoase_admin_settings') }}">
                <input type="hidden" name="action" value="update_fixed_offers">
                <input type="hidden" name="_token" value="{{ csrf_token('settings-offers') }}">
                
                {% set weekday_names = {
                    'Monday': 'Montag',
                    'Tuesday': 'Dienstag',
                    'Wednesday': 'Mittwoch',
                    'Thursday': 'Donnerstag',
                    'Friday': 'Freitag'
                } %}
                
                <div class="space-y-6">
                    {% for weekday, german_name in weekday_names %}
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-bold text-lg text-gray-700 mb-3">{{ german_name }}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {% for period in 1..6 %}
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ period }}. Stunde</label>
                                        <input type="text" 
                                               name="offer_{{ weekday }}_{{ period }}" 
                                               value="{{ fixed_offers[weekday][period] ?? '' }}"
                                               placeholder="Frei w√§hlbar"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        üíæ Feste Angebote speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab: Module -->
        <div id="content-modules" class="tab-content hidden bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Module f√ºr freie Stunden</h2>
            <p class="text-gray-600 mb-6">Diese Module k√∂nnen von Lehrern bei freien Stunden ausgew√§hlt werden (ein Modul pro Zeile).</p>
            
            <form method="POST" action="{{ path('sportoase_admin_settings') }}">
                <input type="hidden" name="action" value="update_free_modules">
                <input type="hidden" name="_token" value="{{ csrf_token('settings-modules') }}">
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Verf√ºgbare Module</label>
                    <textarea name="free_modules" 
                              rows="8" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono"
                              placeholder="Ein Modul pro Zeile..."
                              required>{{ free_modules|join('\n') }}</textarea>
                    <p class="text-sm text-gray-500 mt-2">Tipp: Ein Modul pro Zeile eingeben</p>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        üíæ Module speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab: System -->
        <div id="content-system" class="tab-content hidden bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Systemeinstellungen</h2>
            <p class="text-gray-600 mb-6">Allgemeine Systemparameter f√ºr Buchungen und Kapazit√§ten.</p>
            
            <form method="POST" action="{{ path('sportoase_admin_settings') }}">
                <input type="hidden" name="action" value="update_system_settings">
                <input type="hidden" name="_token" value="{{ csrf_token('settings-system') }}">
                
                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üë• Maximale Sch√ºleranzahl pro Zeitslot
                        </label>
                        <input type="number" 
                               name="max_students_per_period" 
                               value="{{ system_settings.max_students_per_period }}"
                               min="1"
                               max="20"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               required>
                        <p class="text-sm text-gray-500 mt-2">Wie viele Sch√ºler k√∂nnen maximal pro Zeitslot gebucht werden?</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‚è∞ Vorlaufzeit f√ºr Buchungen (Minuten)
                        </label>
                        <input type="number" 
                               name="booking_advance_minutes" 
                               value="{{ system_settings.booking_advance_minutes }}"
                               min="0"
                               max="1440"
                               step="15"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               required>
                        <p class="text-sm text-gray-500 mt-2">Wie viele Minuten im Voraus m√ºssen Buchungen erfolgen?</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition">
                        üíæ Systemeinstellungen speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Back Button -->
        <div class="mt-6">
            <a href="{{ path('sportoase_admin_dashboard') }}" class="inline-block bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition">
                ‚Üê Zur√ºck zum Admin-Dashboard
            </a>
        </div>
    </div>
</div>

<style>
    .tab-button.active {
        border-bottom: 3px solid #3b82f6;
        color: #3b82f6;
        background-color: #eff6ff;
    }
</style>

<script>
function switchTab(tabName) {
    // Hide all content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    
    // Show selected content
    document.getElementById('content-' + tabName).classList.remove('hidden');
    
    // Add active class to selected button
    document.getElementById('tab-' + tabName).classList.add('active');
}
</script>
{% endblock %}
